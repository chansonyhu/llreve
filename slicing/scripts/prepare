#!/bin/bash
echo '#Automatically generated sed script

#remove i32 and nsw
s/i32 //g
s/nsw //g

#remove unneccessary lines

/^!.*/d
/^attributes.*/d
/^target/d

#replace variable names
' > sedScript

#create replacement script for !srcVariable !num with the actual variable
sed -n 's/!\([0-9]*\) = !DILocalVariable(name: "\([a-Z0-9]*\).*/s\/!srcVariable !\1\/\t#=\2\/g/p' $1 >> sedScript

#create replacement script for !srcVariable !num with the actual variable
sed -n 's/!\([0-9]*\) = !DILocalVariable(name: "\([a-Z0-9]*\).*/s\/!srcVariable !\1\/\t#=\2\/g/p' $1 >> sedScript
sed -n 's/!\([0-9]*\) = !{!"not sliced"}.*/s\/!slice !\1\/\t# marked but not sliced\/g/p' $1 >> sedScript
sed -n 's/!\([0-9]*\) = !{!"to be sliced"}.*/s\/!slice !\1\/\t# to be sliced\/g/p' $1 >> sedScript

sed -i -f sedScript $1